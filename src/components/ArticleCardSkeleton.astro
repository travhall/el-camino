---
// src/components/ArticleCardSkeleton.astro - Updated with Unified Loading System
interface Props {
  featured?: boolean;
  variant?: "masonry" | "grid" | "list";
  index?: number;
}

const { featured = false, variant = "masonry", index = 0 } = Astro.props;

// Calculate stagger delay
const staggerDelay = index * 0.1;

// Determine container and layout classes based on variant
const getContainerClasses = () => {
  const baseClasses = "loading-container loading-article-card";
  
  switch (variant) {
    case "list":
      return `${baseClasses} flex flex-row min-h-[140px]`;
    case "grid":
      return `${baseClasses} flex flex-col`;
    case "masonry":
    default:
      return `${baseClasses} flex flex-col aspect-[3/4.5] md:aspect-auto col-span-full md:first-of-type:col-span-4 md:col-span-2 md:row-span-5 md:first-of-type:row-span-4 2xl:row-span-4 2xl:first-of-type:row-span-3 ${
        featured ? "banner-card" : "article-card"
      }`;
  }
};

const getImageClasses = () => {
  const baseClass = "loading-skeleton loading-image";
  switch (variant) {
    case "list":
      return `${baseClass} compact w-40 h-full flex-shrink-0`;
    case "grid":
      return `${baseClass} w-full h-48`;
    case "masonry":
    default:
      return `${baseClass} w-full h-full`;
  }
};

const getContentClasses = () => {
  switch (variant) {
    case "list":
      return "loading-article-content flex flex-col justify-between p-4 flex-1 min-w-0";
    case "grid":
      return "loading-article-content flex flex-col p-4 h-1/3 justify-between";
    case "masonry":
    default:
      return `loading-article-content flex flex-col gap-3 px-6 py-12 xl:p-12 absolute bottom-0 m-1 ${
        featured && "md:w-5/6 lg:w-2/3 right-0"
      }`;
  }
};
---

<div
  class={getContainerClasses()}
  role="status"
  aria-label="Loading article..."
  style={`--loading-stagger-delay: ${staggerDelay}s`}
>
  <!-- Unified Image Skeleton -->
  <div class={getImageClasses()}></div>

  <!-- Unified Content Skeleton -->
  <div class={getContentClasses()}>
    <!-- Category Badge Skeleton (not for list view) -->
    {variant !== "list" && (
      <div class="loading-skeleton loading-badge"></div>
    )}

    <!-- Title Skeleton -->
    <div class="space-y-1">
      <div class="loading-skeleton loading-title"></div>
      {variant !== "list" && (
        <div class="loading-skeleton loading-title multi-line"></div>
      )}
    </div>

    <!-- Date Skeleton -->
    <div class="loading-skeleton loading-text-line" style="width: 6rem; height: 0.75rem;"></div>

    <!-- Excerpt Skeleton -->
    <div class="space-y-1">
      {variant === "list" ? (
        <>
          <div class="loading-skeleton loading-text-line"></div>
          <div class="loading-skeleton loading-text-line" style="width: 75%;"></div>
        </>
      ) : (
        <>
          <div class="loading-skeleton loading-text-line"></div>
          <div class="loading-skeleton loading-text-line"></div>
          <div class="loading-skeleton loading-text-line" style="width: 66%;"></div>
        </>
      )}
    </div>

    <!-- Tags Skeleton -->
    <div class="loading-article-tags">
      {variant === "masonry" && (
        <div class="loading-skeleton loading-tag" style="width: 3rem;"></div>
      )}
      <div class="loading-skeleton loading-tag"></div>
      <div class="loading-skeleton loading-tag" style="width: 5rem;"></div>
      {variant !== "list" && (
        <div class="loading-skeleton loading-tag"></div>
      )}
    </div>
  </div>

  <span class="sr-only">Loading article information...</span>
</div>

<style>
  /* Component-specific overrides */
  .loading-article-card {
    background: var(--ui-card-surface, #ffffff);
    border: 1px solid var(--ui-card-border, #e5e7eb);
    border-radius: 0.375rem;
    overflow: hidden;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .flex.flex-row .loading-text-line:last-child {
      display: none;
    }
  }
  
  /* Dark theme integration */
  :global([data-theme="dark"]) .loading-article-card {
    background: var(--ui-card-surface-dark, #1f2937);
    border-color: var(--ui-card-border-dark, #374151);
  }
</style>