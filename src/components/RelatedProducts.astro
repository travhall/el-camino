---
// /src/components/RelatedProducts.astro - Refactored to use ProductCard
import type { Product } from "@/lib/square/types";
import ProductCard from "@/components/ProductCard.astro";
import { batchInventoryService } from "@/lib/square/batchInventory";

interface Props {
  products: Product[];
  title?: string;
}

const { products, title = "Complete Your Setup" } = Astro.props;

if (products.length === 0) {
  return null;
}

// Batch inventory check for optimal performance
const variationIds = products.map(p => p.variationId).filter(Boolean);
const inventoryMap = await batchInventoryService.getBatchInventoryStatus(variationIds);
---

<section class="related-products">
  <h2 class="text-2xl lg:text-3xl font-display font-bold mb-4 text-(--content-heading)">
    {title}
  </h2>

  <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-1">
    {products.map((product, index) => {
      const inventoryStatus = inventoryMap.get(product.variationId);
      return (
        <ProductCard 
          product={product}
          index={index}
          priority={index < 2}
          inventoryStatus={inventoryStatus}
          skipInventoryCheck={true}
        />
      );
    })}
  </div>
</section>
