---
import type { BlogPost } from '@/lib/types'
import { Icon } from 'astro-icon'

type Props = {
  post: BlogPost
}

const { post } = Astro.props

const publishedDate = new Date(post.publishedDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
})

const updateDate = post.updatedAt ? new Date(post.updatedAt).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}) : null
---

<article class="max-w-4xl mx-auto">
  <header class="mb-8">
    <div class="flex flex-wrap gap-4 text-content-meta mb-4">
      <div class="flex items-center gap-2">
        <Icon name="calendar" class="w-4 h-4" />
        <time datetime={post.publishedDate}>{publishedDate}</time>
      </div>
      
      <div class="flex items-center gap-2">
        <Icon name="folder" class="w-4 h-4" />
        <a href={`/news/category/${post.category.slug}`} class="hover:underline">
          {post.category.name}
        </a>
      </div>

      {updateDate && updateDate !== publishedDate && (
        <div class="flex items-center gap-2">
          <Icon name="edit" class="w-4 h-4" />
          <span>Updated {updateDate}</span>
        </div>
      )}
    </div>
    
    <h1 class="text-display-xl md:text-display-2xl text-content-heading mb-4">
      {post.title}
    </h1>
    
    <p class="text-body-lg text-content-body mb-6">
      {post.excerpt}
    </p>

    <div class="flex items-center gap-4 text-content-meta">
      <div class="flex items-center gap-2">
        <Icon name="user" class="w-4 h-4" />
        <span>{post.author.name}</span>
      </div>
      
      {post.tags && post.tags.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {post.tags.map((tag) => (
            <a
              href={`/news/tag/${tag.slug}`}
              class="px-3 py-1 bg-surface-secondary text-content-meta rounded-full hover:bg-surface-tertiary transition-colors"
            >
              {tag.name}
            </a>
          ))}
        </div>
      )}
    </div>
  </header>

  {post.featuredImage && (
    <figure class="mb-8">
      <img
        src={post.featuredImage.url}
        alt={post.featuredImage.altText || post.title}
        class="w-full rounded-lg"
      />
      {post.featuredImage.caption && (
        <figcaption class="mt-2 text-content-caption text-center">
          {post.featuredImage.caption}
        </figcaption>
      )}
    </figure>
  )}

  <div class="content">
    <Fragment set:html={post.content} />
  </div>
</article>

<style>
  .content :global(h2) {
    @apply text-display-lg text-content-heading mt-8 mb-4;
  }
  
  .content :global(h3) {
    @apply text-display-base text-content-heading mt-6 mb-3;
  }
  
  .content :global(p) {
    @apply text-body-lg text-content-body mb-4;
  }
  
  .content :global(ul), .content :global(ol) {
    @apply mb-4 pl-6;
  }
  
  .content :global(ul) {
    @apply list-disc;
  }
  
  .content :global(ol) {
    @apply list-decimal;
  }
  
  .content :global(li) {
    @apply text-body-lg text-content-body mb-2;
  }
  
  .content :global(blockquote) {
    @apply pl-4 border-l-4 border-content-meta italic my-6;
  }
  
  .content :global(a) {
    @apply text-content-emphasis hover:underline;
  }
  
  .content :global(img) {
    @apply rounded-lg my-6;
  }
</style>