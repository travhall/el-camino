---
import Layout from "@/layouts/Layout.astro";
import ProductCard from "@/components/ProductCard.astro";
import type { ArticlesResponse } from "@/lib/types/content";
import type { Product } from "@/lib/square/types";
import { fetchProducts } from "@/lib/square/client";
import ArticleGrid from "@/components/ArticleGrid.astro";
import { fetchGraphQL } from "@/lib/graphql";
import { GET_RECENT_ARTICLES } from "@/lib/queries";

// Fetch products with error handling and proper typing
let products: Product[] = [];
try {
  console.log("Fetching Square products...");
  products = await fetchProducts();
  console.log("Products fetched successfully:", products.length);
} catch (error) {
  console.error("Error fetching products:", error);
}

// Fetch 6 most recent articles
const response = await fetchGraphQL<ArticlesResponse>(GET_RECENT_ARTICLES, {
  limit: 6,
});
const recentArticles = response.articles;
---

<Layout title="El Camino Skate Shop">
  <main>
    <ArticleGrid articles={recentArticles} featured={true} />
    {
      products.length > 0 && (
        <div class="card-grid grid justify-center grid-cols-6 2xl:grid-cols-8 md:auto-rows-[10vw] max-w-[120rem] mx-auto gap-1 p-1">
          {products.map((product) => (
            <ProductCard product={product} />
          ))}
        </div>
      )
    }
  </main>
</Layout>
