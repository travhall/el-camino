<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Manager</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <script>
      window.CMS_MANUAL_INIT = true;
      
      // Check if we're in development
      const isDev = window.location.hostname === 'localhost' || 
                   window.location.hostname === '127.0.0.1';

      // Initialize Netlify Identity
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }

      // Configure CMS
      const config = {
        backend: {
          name: isDev ? "test-repo" : "git-gateway",
          branch: "master",
          repo: "travhall/el-camino",
          api_root: "https://elcaminoskateshop.netlify.app/.netlify/git/github"
        },
        local_backend: isDev,
        load_config_file: true,
        media_folder: "public/media",
        public_folder: "/media",
        site_url: isDev ? "http://localhost:4321" : "https://elcaminoskateshop.netlify.app",
        display_url: isDev ? "http://localhost:4321" : "https://elcaminoskateshop.netlify.app",
        logo_url: isDev ? "/logo.svg" : "https://elcaminoskateshop.netlify.app/logo.svg"
      };

      // Wait for both Identity and CMS to load
      window.addEventListener('load', function() {
        // Load Decap CMS
        if (window.CMS) {
          CMS.init({ config });
        }
      });
    </script>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  </body>
</html>